---

---

<article class="home-newsletter">
  <p class="home-newsletter--text">
    Suscríbete a nuestra newsletter. Es gratuito y puedes darte de baja cuando
    quieras.
  </p>
  <form
    class="home-newsletter--form"
    action=""
    method="post"
    id="newsletterForm"
  >
    <div class="home-newsletter--row">
      <input
        class="home-newsletter--email"
        type="email"
        placeholder="Tu email"
        name="email"
        id="email"
      />
      <label class="nl-honeypot" style="display:none;">
        <input
          type="text"
          name="website"
          id="website"
          tabindex="-1"
          autocomplete="off"
        />
      </label>
      <input class="home-newsletter--submit" type="submit" value="Enviar" />
    </div>
    <label class="home-newsletter--row__check">
      <input
        class="nl-check--check"
        type="checkbox"
        id="consent"
        name="consent"
        required
      />
      He leido y acepto la<a href="/politica-privacidad"
        >&nbsp;política de privacidad</a
      >
    </label>
  </form>

  <script>
    const form = document.querySelector("#newsletterForm") as HTMLFormElement;
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = (document.querySelector("#email") as HTMLInputElement)
        .value;
      const website = (document.querySelector("#website") as HTMLInputElement)
        .value;
      if (website.trim() !== "") {
        console.warn("Bot detectado (honeypot rellenado).");
        return;
      }
      try {
        const response = await fetch(
          "https://api.keinoestudio.com/newsletter",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
            },
            body: JSON.stringify({
              email: email,
              consent: true,
            }),
          }
        );

        const data = await response.json();

        if (response.ok) {
          window.location.href = "/subscribed";
        } else {
          alert("Error: " + (data.error || "Error registering email"));
        }
      } catch (err) {
        alert(err);
      }
    });
  </script>
</article>
<style lang="scss">
  @use "@styles/vars" as *;

  .home-newsletter {
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    padding: 2rem 1.5rem;
    width: 100%;
    z-index: 50;

    @include device(lg) {
      flex-direction: row;
      padding: 3rem 1.5rem;
    }

    &--text {
      font-family: $display;
      width: 100%;

      @include device(lg) {
        max-width: 400px;
      }
    }

    &--form {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    &--row {
      display: flex;
      flex-direction: row;
      width: 100%;
      background-color: rgba($ke-blue, 0.2);
      border-radius: 0.2rem;
      font-family: $display;
      font-size: 1.2rem;
      font-weight: medium;
      height: 44px;
      gap: 0;

      &__check {
        width: 100%;
        height: 40px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: end;
        color: $ke-blue;
        font-size: 1rem;
      }
    }

    &--email {
      width: 100%;
      flex-shrink: 1;
      padding: 0 1rem;
    }

    &--submit {
      width: 120px;
      padding: 0 1.5rem;
      text-align: left;
      cursor: pointer;
      border-radius: 0 0.2rem 0.2rem 0;
      transition: all 200ms ease-in-out;

      &:hover {
        background-color: $ke-white;
        color: $ke-blue;
      }
    }
    .nl-check {
      &--text {
        font-size: 1rem;
        color: $ke-blue;
        margin-right: 1.2rem;
      }
      &--check {
        width: 1rem;
        height: 1rem;
        margin-right: 1rem;
      }
    }
  }
</style>
